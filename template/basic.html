<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AQI Preset Scenarios - Air Quality Predictor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='basic.css') }}">
</head>
<body>
     <nav>
        <div class="nav-container">
            <div class="logo">AQI Predictor</div>
            <ul class="nav-links">
                <li><a href="{{ url_for('index') }}">Home</a></li>
                <!-- <li><a href="{{ url_for('info')}}" >Info</a></li> -->
                <li class="dropdown">
                    <a href="#" class="dropbtn">AQI</a>
                    <div class="dropdown-content">
                        <a href="{{ url_for('basic') }}">Basic</a>
                        <a href="{{ url_for('advance') }}">Advanced</a>
                    </div>
                </li>
                <li><a href="{{ url_for('info')}}" >Info</a></li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <div class="header">
            <h1> AQI Preset Scenarios</h1>
            <p>Choose from predefined air quality scenarios to see instant predictions</p>
        </div>

        <div class="content">
            <div class="scenarios-grid">
                <div class="scenario-card" data-scenario="1">
                    <div class="scenario-title">
                        <span class="scenario-emoji"></span>
                        Clean Air Day
                    </div>
                    <div class="scenario-details">
                        <div class="detail-item">
                            <span class="detail-label">PM2.5:</span>
                            <span class="detail-value">15 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">PM10:</span>
                            <span class="detail-value">25 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">NO2:</span>
                            <span class="detail-value">10 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">SO2:</span>
                            <span class="detail-value">5 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">CO:</span>
                            <span class="detail-value">0.3 mg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">O3:</span>
                            <span class="detail-value">45 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Temp:</span>
                            <span class="detail-value">22°C</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Rain:</span>
                            <span class="detail-value">2 mm</span>
                        </div>
                    </div>
                </div>

                <div class="scenario-card" data-scenario="2">
                    <div class="scenario-title">
                        <span class="scenario-emoji"></span>
                        Moderate Pollution
                    </div>
                    <div class="scenario-details">
                        <div class="detail-item">
                            <span class="detail-label">PM2.5:</span>
                            <span class="detail-value">65 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">PM10:</span>
                            <span class="detail-value">85 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">NO2:</span>
                            <span class="detail-value">30 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">SO2:</span>
                            <span class="detail-value">15 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">CO:</span>
                            <span class="detail-value">1.2 mg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">O3:</span>
                            <span class="detail-value">75 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Temp:</span>
                            <span class="detail-value">28°C</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Rain:</span>
                            <span class="detail-value">0 mm</span>
                        </div>
                    </div>
                </div>

                <div class="scenario-card" data-scenario="3">
                    <div class="scenario-title">
                        <span class="scenario-emoji"></span>
                        Heavy Pollution Day
                    </div>
                    <div class="scenario-details">
                        <div class="detail-item">
                            <span class="detail-label">PM2.5:</span>
                            <span class="detail-value">150 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">PM10:</span>
                            <span class="detail-value">220 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">NO2:</span>
                            <span class="detail-value">60 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">SO2:</span>
                            <span class="detail-value">35 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">CO:</span>
                            <span class="detail-value">2.5 mg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">O3:</span>
                            <span class="detail-value">120 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Temp:</span>
                            <span class="detail-value">32°C</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Rain:</span>
                            <span class="detail-value">0 mm</span>
                        </div>
                    </div>
                </div>

                <div class="scenario-card" data-scenario="4">
                    <div class="scenario-title">
                        <span class="scenario-emoji"></span>
                        Post-Rain Clear
                    </div>
                    <div class="scenario-details">
                        <div class="detail-item">
                            <span class="detail-label">PM2.5:</span>
                            <span class="detail-value">25 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">PM10:</span>
                            <span class="detail-value">40 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">NO2:</span>
                            <span class="detail-value">12 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">SO2:</span>
                            <span class="detail-value">6 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">CO:</span>
                            <span class="detail-value">0.4 mg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">O3:</span>
                            <span class="detail-value">55 µg/m³</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Temp:</span>
                            <span class="detail-value">24°C</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Rain:</span>
                            <span class="detail-value">15 mm</span>
                        </div>
                    </div>
                </div>
            </div>

            <button id="predictBtn" class="predict-button" disabled>
                Select a scenario to predict AQI
            </button>

            <div id="loadingDiv" class="loading" style="display: none;">
                Making prediction...
            </div>

            <div id="resultsSection" class="results-section">
                <div class="aqi-display">
                    <div class="aqi-value" id="aqiValue">--</div>
                    <div class="aqi-category" id="aqiCategory">--</div>
                </div>

                <div class="health-info">
                    <div class="health-card">
                        <h4>Health Advice</h4>
                        <p id="healthAdvice">--</p>
                    </div>
                    <div class="health-card">
                        <h4>Activities</h4>
                        <p id="activities">--</p>
                    </div>
                    <div class="health-card">
                        <h4>Precautions</h4>
                        <p id="precautions">--</p>
                    </div>
                </div>

                <div class="input-summary">
                    <h4>Scenario Parameters Used</h4>
                    <div class="input-grid" id="inputGrid">
                        <!-- Input parameters will be populated here -->
                    </div>
                </div>
            </div>

            <!-- <div class="nav-buttons">
                <a href="/" class="nav-button">Home</a>
                <a href="/advance" class="nav-button"> Advanced Prediction</a>
                <a href="/basic" class="nav-button">Basic Mode</a>
            </div> -->
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2024 Air Quality Index Predictor. All rights reserved.</p>
            <p>Stay informed, breathe better.</p>
        </div>
    </footer>

    <script>
        // Scenario data matching the backend
        const scenarios = {
            '1': {
                name: 'Clean Air Day',
                station_id: 1,
                pm2_5: 15, pm10: 25, no2: 10, so2: 5,
                co: 0.3, o3: 45, temp_c: 22, rain_mm: 2
            },
            '2': {
                name: 'Moderate Pollution',
                station_id: 1,
                pm2_5: 65, pm10: 85, no2: 30, so2: 15,
                co: 1.2, o3: 75, temp_c: 28, rain_mm: 0
            },
            '3': {
                name: 'Heavy Pollution Day',
                station_id: 1,
                pm2_5: 150, pm10: 220, no2: 60, so2: 35,
                co: 2.5, o3: 120, temp_c: 32, rain_mm: 0
            },
            '4': {
                name: 'Post-Rain Clear',
                station_id: 2,
                pm2_5: 25, pm10: 40, no2: 12, so2: 6,
                co: 0.4, o3: 55, temp_c: 24, rain_mm: 15
            }
        };

        let selectedScenario = null;

        // Handle scenario selection
        document.querySelectorAll('.scenario-card').forEach(card => {
            card.addEventListener('click', function() {
                // Remove selection from other cards
                document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('selected'));
                
                // Select this card
                this.classList.add('selected');
                selectedScenario = this.dataset.scenario;
                
                // Enable predict button
                const predictBtn = document.getElementById('predictBtn');
                predictBtn.disabled = false;
                predictBtn.textContent = `Predict AQI for ${scenarios[selectedScenario].name}`;
            });
        });

        // Handle prediction
        document.getElementById('predictBtn').addEventListener('click', async function() {
            if (!selectedScenario) return;

            const scenario = scenarios[selectedScenario];
            const loadingDiv = document.getElementById('loadingDiv');
            const resultsSection = document.getElementById('resultsSection');

            // Show loading
            loadingDiv.style.display = 'block';
            resultsSection.classList.remove('show');

            try {
                // Create form data
                const formData = new FormData();
                formData.append('std-id', scenario.station_id);
                formData.append('pm25', scenario.pm2_5);
                formData.append('pm10', scenario.pm10);
                formData.append('no2', scenario.no2);
                formData.append('so2', scenario.so2);
                formData.append('co', scenario.co);
                formData.append('o3', scenario.o3);
                formData.append('temp', scenario.temp_c);
                formData.append('rain', scenario.rain_mm);

                // Make prediction request
                const response = await fetch('/advance', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const html = await response.text();
                    
                    // Parse the response to extract prediction data
                    // This is a simple approach - in production you'd want a JSON API
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Extract prediction data from the response
                    // You would need to modify the backend to return JSON for better integration
                    
                    // For now, simulate the prediction result
                    simulatePrediction(scenario);
                } else {
                    throw new Error('Prediction request failed');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Prediction failed. Please try again.');
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        // Simulate prediction (replace with actual backend integration)
        function simulatePrediction(scenario) {
            // Simple AQI calculation based on PM2.5 (simplified for demo)
            let aqi = Math.round(scenario.pm2_5 * 2.5 + scenario.pm10 * 1.2 + Math.random() * 20);
            
            let category, color;
            if (aqi <= 50) {
                category = "Good ";
                color = "#00E400";
            } else if (aqi <= 100) {
                category = "Satisfactory ";
                color = "#FFFF00";
            } else if (aqi <= 200) {
                category = "Moderate ";
                color = "#FF7E00";
            } else if (aqi <= 300) {
                category = "Poor ";
                color = "#FF0000";
            } else if (aqi <= 400) {
                category = "Very Poor ";
                color = "#8F3F97";
            } else {
                category = "Severe ";
                color = "#7E0023";
            }

            // Update display
            document.getElementById('aqiValue').textContent = aqi;
            document.getElementById('aqiCategory').textContent = category;
            document.getElementById('aqiCategory').style.backgroundColor = color;

            // Update health info based on category
            updateHealthInfo(category);
            updateInputSummary(scenario);

            // Show results
            document.getElementById('resultsSection').classList.add('show');
        }

        function updateHealthInfo(category) {
            const healthAdviceMap = {
                "Good ": {
                    advice: "Air quality is good. Perfect for all outdoor activities.",
                    activities: "Jogging, cycling, outdoor sports recommended",
                    precautions: "No precautions needed"
                },
                "Satisfactory ": {
                    advice: "Air quality is acceptable for most people.",
                    activities: "Normal outdoor activities are fine",
                    precautions: "Sensitive individuals may experience minor discomfort"
                },
                "Moderate ": {
                    advice: "Unhealthy for sensitive groups.",
                    activities: "Reduce prolonged outdoor exertion",
                    precautions: "People with respiratory conditions should limit outdoor activities"
                },
                "Poor ": {
                    advice: "Everyone should limit outdoor activities.",
                    activities: "Avoid outdoor sports and exercise",
                    precautions: "Wear masks when going outside, keep windows closed"
                },
                "Very Poor ": {
                    advice: "Avoid outdoor activities entirely.",
                    activities: "Stay indoors, use air purifiers",
                    precautions: "Serious health risk for everyone, especially children and elderly"
                },
                "Severe ": {
                    advice: "Health emergency! Stay indoors.",
                    activities: "Emergency conditions - no outdoor activities",
                    precautions: "Seek immediate medical attention if experiencing breathing difficulties"
                }
            };

            const info = healthAdviceMap[category] || {
                advice: "Unknown category",
                activities: "Consult health guidelines",
                precautions: "Exercise caution"
            };

            document.getElementById('healthAdvice').textContent = info.advice;
            document.getElementById('activities').textContent = info.activities;
            document.getElementById('precautions').textContent = info.precautions;
        }

        function updateInputSummary(scenario) {
            const inputGrid = document.getElementById('inputGrid');
            inputGrid.innerHTML = `
                <div class="input-item">
                    <span>Station ID:</span>
                    <span>${scenario.station_id}</span>
                </div>
                <div class="input-item">
                    <span>PM2.5:</span>
                    <span>${scenario.pm2_5} µg/m³</span>
                </div>
                <div class="input-item">
                    <span>PM10:</span>
                    <span>${scenario.pm10} µg/m³</span>
                </div>
                <div class="input-item">
                    <span>NO2:</span>
                    <span>${scenario.no2} µg/m³</span>
                </div>
                <div class="input-item">
                    <span>SO2:</span>
                    <span>${scenario.so2} µg/m³</span>
                </div>
                <div class="input-item">
                    <span>CO:</span>
                    <span>${scenario.co} mg/m³</span>
                </div>
                <div class="input-item">
                    <span>O3:</span>
                    <span>${scenario.o3} µg/m³</span>
                </div>
                <div class="input-item">
                    <span>Temperature:</span>
                    <span>${scenario.temp_c}°C</span>
                </div>
                <div class="input-item">
                    <span>Rainfall:</span>
                    <span>${scenario.rain_mm} mm</span>
                </div>
            `;
        }
    </script>
</body>
</html>